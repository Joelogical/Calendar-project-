<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calendar</title>
    <link rel="stylesheet" href="style.css" />
    <style>
      /* Minimal inline styles so you can see structure before adding CSS */
      body {
        font-family: system-ui, Arial, sans-serif;
        margin: 0;
      }
      /* .container styles moved to style.css */
      .header {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      /* .content, .calendar, and .events styles moved to style.css */
      .hint {
        color: #555;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>Dance Events Calendar</h1>
      </div>
      <div class="calendar-header">
        <div>
          <button id="space1Btn" class="calendar-switcher active">
            The Emerald
          </button>
          <button id="space2Btn" class="calendar-switcher">The Grand</button>
        </div>
        <div>
          <button id="prevBtn" type="button">Prev</button>
          <span id="currentLabel" aria-live="polite"></span>
          <button id="nextBtn" type="button">Next</button>
        </div>
      </div>
      <div class="content">
        <div class="calendar"></div>
        <div class="event-details">
          <h3>Event Details</h3>
          <div id="eventDetailsContent">
            <p class="no-selection">Click on an event to see details</p>
            <img
              id="event-image"
              src=""
              alt="Event Image"
              style="display: none"
            />
            <p id="event-name"></p>
            <p id="event-date"></p>
            <p id="event-time"></p>
            <p id="event-location"></p>
            <p id="event-description"></p>
            <p id="event-contact"></p>
            <p id="event-contact-email"></p>
            <p id="event-contact-phone"></p>
          </div>
        </div>
        <div class="events">
          <h3>Add Event</h3>
          <form id="addEventForm">
            <div class="form-group">
              <label for="eventName">Event Name:</label>
              <input type="text" id="eventName" required />
            </div>
            <div class="form-group">
              <label for="eventDate">Date:</label>
              <input type="date" id="eventDate" required />
            </div>
            <button type="submit">Add Event</button>
          </form>
        </div>
        <p class="hint">
          Open DevTools Console. Try:
          <code>generateMonthGrid(2025, 3, 'Mon')</code>
        </p>
      </div>
    </div>

    <!-- Load compiled JS (you'll run tsc to generate app.js) -->
    <script type="module" src="app.js"></script>
    <!-- Re-export function to the window for easy console access -->
    <script type="module">
      import { generateMonthGrid, renderMonthGrid } from "./app.js";
      // @ts-ignore - this is plain JS in the browser
      window.generateMonthGrid = generateMonthGrid;

      // Get references to DOM elements
      const label = document.getElementById("currentLabel");
      const prev = document.getElementById("prevBtn");
      const next = document.getElementById("nextBtn");
      const calendarDiv = document.querySelector(".calendar");
      const space1Btn = document.getElementById("space1Btn");
      const space2Btn = document.getElementById("space2Btn");

      // Track current year and month
      let ym = { y: new Date().getFullYear(), m: new Date().getMonth() + 1 };

      // Store events for each calendar
      const calendars = {
        space1: {
          name: "Space 1", // or whatever you want to call them
          events: {}, // Will store events by date like "2025-03-15": ["Event 1", "Event 2"]
        },
        space2: {
          name: "Space 2",
          events: {},
        },
      };

      // Track which calendar is currently active
      let activeCalendar = "space1";

      // Function to update the month/year label
      function renderLabel() {
        label.textContent = `${ym.y}-${String(ym.m).padStart(2, "0")}`;
      }

      // Function to render the calendar grid
      function renderCalendar() {
        if (calendarDiv) {
          // Call renderMonthGrid with current year, month, weekStart, and events
          const html = renderMonthGrid(
            ym.y,
            ym.m,
            "Sun",
            calendars[activeCalendar].events
          );
          calendarDiv.innerHTML = html;
        }
      }

      // Update both label and calendar when month changes
      function updateCalendar() {
        renderLabel();
        renderCalendar();
      }

      // Set up button event listeners
      prev?.addEventListener("click", () => {
        ym.m--;
        if (ym.m === 0) {
          ym.m = 12;
          ym.y--;
        }
        updateCalendar();
      });

      next?.addEventListener("click", () => {
        ym.m++;
        if (ym.m === 13) {
          ym.m = 1;
          ym.y++;
        }
        updateCalendar();
      });

      // Calendar switcher event listeners
      space1Btn?.addEventListener("click", () => {
        activeCalendar = "space1";
        space1Btn.classList.add("active");
        space2Btn.classList.remove("active");
        updateCalendar(); // Re-render with the active calendar
      });

      space2Btn?.addEventListener("click", () => {
        activeCalendar = "space2";
        space2Btn.classList.add("active");
        space1Btn.classList.remove("active");
        updateCalendar();
      });

      // Add event form handler
      const addEventForm = document.getElementById("addEventForm");
      const eventNameInput = document.getElementById("eventName");
      const eventDateInput = document.getElementById("eventDate");

      addEventForm?.addEventListener("submit", (e) => {
        e.preventDefault(); // Prevent page refresh

        const eventName = eventNameInput.value.trim();
        const eventDate = eventDateInput.value; // Format: YYYY-MM-DD

        if (eventName && eventDate) {
          // Get the active calendar
          const activeCal = calendars[activeCalendar];

          // Initialize events array for this date if it doesn't exist
          if (!activeCal.events[eventDate]) {
            activeCal.events[eventDate] = [];
          }

          // Add the event to the array
          activeCal.events[eventDate].push(eventName);

          // Clear the form
          eventNameInput.value = "";
          eventDateInput.value = "";

          // Re-render the calendar to show the new event
          updateCalendar();

          console.log(
            `Added "${eventName}" to ${activeCal.name} on ${eventDate}`
          );
        }
      });

      // Initial render when page loads - wait for DOM to be ready
      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", () => {
          updateCalendar();
        });
      } else {
        // DOM is already ready
        updateCalendar();
      }
    </script>
  </body>
</html>
